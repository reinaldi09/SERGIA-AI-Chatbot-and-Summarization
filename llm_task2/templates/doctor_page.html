<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor Dashboard</title>
</head>
<body>
    <h2>Welcome, {{ doctorName }}!</h2>
    <div id="patientList"></div>
    <form action="/logout" method="POST">
        <button type="logout">Logout</button>
    </form>

    <script>
        // Ambil data pasien untuk dokter
        const doctorName = "{{ doctorName }}";

        async function getPatientData() {
        try {
            const response = await fetch(`/get_patient_data?doctor=${doctorName}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch patient data');
            }

            const data = await response.json();

            // Display patients and summaries
            const patientList = document.getElementById("patientList");
            patientList.innerHTML = ''; // Kosongkan daftar sebelum menambahkan data baru

            for (const [patient, details] of Object.entries(data)) {
                patientList.innerHTML += `
                    <div>
                        <strong>Patient:</strong> ${patient} <br>
                        <strong>Summary:</strong> ${details.summary} <br>
                        <a href="${details.pdf_file}" download>Download PDF</a>
                    </div><br>
                `;
            }
        } catch (error) {
            console.error('Error fetching patient data:', error);
            const patientList = document.getElementById("patientList");
            patientList.innerHTML = 'No patients found for this doctor.';
<!--            patientList.innerHTML = 'Failed to load patient data. Please try again later.';-->
        }
    }
    getPatientData();
    </script>
</body>
</html>
